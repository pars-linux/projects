diff -Nuar elsa.orig/configure.ac elsa/configure.ac
--- elsa.orig/configure.ac	2011-03-06 18:53:17.470237250 +0200
+++ elsa/configure.ac	2011-03-07 11:27:07.565603217 +0200
@@ -30,7 +30,19 @@
 
 
 ### Additional options to configure
-
+# ConsoleKit support
+AC_ARG_WITH(consolekit, AC_HELP_STRING([--with-consolekit], [Use ConsoleKit]),
+   [USE_CONSOLEKIT=$withval], [USE_CONSOLEKIT=yes])
+if test x"$USE_CONSOLEKIT" != xno; then
+   PKG_CHECK_MODULES(CK_CONNECTOR, ck-connector,
+       [USE_CONSOLEKIT=yes], [USE_CONSOLEKIT=no])
+   if test x"$USE_CONSOLEKIT" = xyes; then
+       AC_DEFINE([USE_CONSOLEKIT], 1, [Define to 1 to use ConsoleKit])
+       CFLAGS="$XDM_CFLAGS $CK_CONNECTOR_CFLAGS"
+       LIBS="$XDM_LIBS $CK_CONNECTOR_LIBS"
+   fi
+fi
+dnl AM_CONDITIONAL(USE_CONSOLEKIT, test$USE_CONSOLEKIT = xyes)
 # Pam
 AC_ARG_ENABLE([pam],
    [AC_HELP_STRING([--disable-pam], [disable pam support. @<:@default=enabled@:>@])],
diff -Nuar elsa.orig/src/daemon/elsa_session.c elsa/src/daemon/elsa_session.c
--- elsa.orig/src/daemon/elsa_session.c	2011-03-06 18:53:17.481242750 +0200
+++ elsa/src/daemon/elsa_session.c	2011-03-07 23:53:18.196843630 +0200
@@ -8,7 +8,8 @@
 #include <stdlib.h>
 #include <sys/types.h>
 #include <sys/wait.h>
-
+#include <ck-connector.h>
+#include <glib.h>
 #include "elsa.h"
 
 
@@ -20,6 +21,12 @@
 static int _elsa_session_userid_set(struct passwd *pwd);
 static void _elsa_session_run(struct passwd *pwd, const char *cmd, const char *cookie);
 
+static CkConnector *connector;
+
+
+
+
+
 long
 elsa_session_seed_get()
 {
@@ -108,6 +115,31 @@
 #ifdef HAVE_PAM
    char **tmp;
    char buf[PATH_MAX];
+     printf(": ENGIN start\n");
+    connector = ck_connector_new();
+
+   printf(": ENGIN connector olusturuldu\n");
+   if(connector!=NULL){
+       dbus_bool_t is_local;
+       is_local= 1==1;
+      DBusError error;
+      dbus_error_init (&error);
+   printf(": ENGIN dbus hata baslatildi\n");
+   ck_connector_open_session(connector,&error);
+    /*ck_connector_open_session_with_parameters(
+        connector, &error,
+        //"unix-user", 1000,
+        //"x11-display", "",
+        //"x11-display-device", "/dev/tty7",
+        //"remote-host-name", "",
+        "is-local", &is_local,
+        NULL);*/
+    setenv("XDG_SESSION_COOKIE",ck_connector_get_cookie(connector),1);
+    printf(" ENGIN cookie %s\n",ck_connector_get_cookie(connector));
+
+   }
+   printf(": ENGIN bitti\n");
+ 
    pid_t pid;
    pid = fork();
    if (pid == 0)
@@ -137,6 +169,7 @@
         remove(buf);
         snprintf(buf, sizeof(buf), "%s > %s/.elsa_session.log 2>&1",
                  cmd, pwd->pw_dir);
+
         execle(pwd->pw_shell, pwd->pw_shell, "-c", buf, NULL, env);
         fprintf(stderr, PACKAGE": The Xsessions are not launched :(\n");
      }
